<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      
        Multi-armed bandits |
      
      The Architect</title>
    <meta
    name="description" content="A complete post."> <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link
    rel="stylesheet" href="/css/styles.css"> <!-- Prism CSS for code syntax highlighting -->
    <link
    rel="stylesheet" href="/css/prism.css"> <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/favicon.ico?v=2" type="image/x-icon">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/img/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
      <div class="container">
        <a class="navbar-brand" href="/">The Architect</a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
              <li class="nav-item ">
                <a class="nav-link" href="/">Home</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/about/">About</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/author/">Author</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/contact/">Contact</a>
              </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Main Content -->
    <main>
      
<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <article class="post">
        <header class="article-header">
          <h1 class="article-title">Multi-armed bandits</h1>
          <div class="article-meta">
            <span><i class="far fa-calendar-alt mr-1"></i> 06 Feb 2021</span>
            
            <span class="ml-3">
              <i class="far fa-folder-open mr-1"></i><a href="/categories/#machine-learning">Machine Learning</a></span>
            
          </div>
        </header>

        
        <div class="article-image mb-4">
          <img src="/img/multi_armed_bandit.jpg" alt="Multi-armed bandits" class="img-fluid w-100">
        </div>
        

        <div class="article-content">
          <style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap');
  
  body {
      font-family: 'Open Sans', sans-serif;
  }

  h1 {
    font-family: 'Roboto', sans-serif;
    color: #007bff;
    margin-top: 30px;
  }

  h3 {
    font-family: 'Roboto', sans-serif;
    color: #007bff;
    margin-top: 30px;
  }

  h4 {
    font-family: 'Roboto', sans-serif;
    color: #EA950B;
    margin-top: 30px;
  }

  pre {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 5px;
  }
</style>
<h3 id="introduction" tabindex="-1">Introduction <a class="direct-link" href="#introduction" aria-hidden="true"></a></h3>
<p>The objective of this lab session is to test the performance of some usual bandit algorithms.</p>
<pre class="code-block language-python"><code class=" language-python">import numpy as np
import matplotlib.pyplot as plt
</code></pre><h3 id="algorithms" tabindex="-1">Algorithms <a class="direct-link" href="#algorithms" aria-hidden="true"></a></h3>
<p>There are $$k$$ possible actions, $$a \in { 0, 1,â€¦,k - 1}$$.</p>
<p>We consider the following algorithms:</p>
<ul>
<li>$$\varepsilon$$-greedy</li>
<li>adaptive greedy</li>
<li>UCB</li>
<li>Thompson sampling</li>
</ul>
<p>Each algorithm returns an action based on the following inputs:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Variable</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>nb_tries</code></td>
<td style="text-align:left">1D array of int of size <code>k</code></td>
<td style="text-align:left">number of tries of each action so far</td>
</tr>
<tr>
<td style="text-align:left"><code>cum_rewards</code></td>
<td style="text-align:left">1D array of float of size <code>k</code></td>
<td style="text-align:left">cumulative reward of each action so far</td>
</tr>
<tr>
<td style="text-align:left"><code>param</code></td>
<td style="text-align:left">mixed</td>
<td style="text-align:left">parameter of the algorithm</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>Note:</strong> Use the <code>simple_test</code> function to test the behaviour of the algorithms for binary rewards.</p>
<hr>
<pre class="code-block language-python"><code class=" language-python">def eps_greedy(nb_tries, cum_rewards, param):
    if param == None:
        eps = 0.1
    else:
        eps = float(param)
    k = np.shape(nb_tries)[0]
    if np.sum(nb_tries) == 0 or np.random.random() < eps:
        return np.random.randint(k)
    else:
        index = np.where(nb_tries > 0)[0]
        return index[np.argmax(cum_rewards[index] / nb_tries[index])]
</code></pre><pre class="code-block language-python"><code class=" language-python">def adaptive_greedy(nb_tries, cum_rewards, param):
    if param == None:
        c = 1.
    else:
        c = float(param)
    k = np.shape(nb_tries)[0]
    t = np.sum(nb_tries)
    if np.sum(nb_tries) == 0 or np.random.random() < c / (c + t):
        return np.random.randint(k)
    else:
        index = np.where(nb_tries > 0)[0]
        return index[np.argmax(cum_rewards[index] / nb_tries[index])]
</code></pre><pre class="code-block language-python"><code class=" language-python">def ucb(nb_tries, cum_rewards, param):
    if param == None:
        c = 1. 
    else:
        c = float(param)
    if np.sum(nb_tries == 0) > 0:
        index = np.where(nb_tries == 0)[0]
        return np.random.choice(index)
    else:
        t = np.sum(nb_tries)
        upper_bounds = cum_rewards / nb_tries + c * np.sqrt(np.log(t) / nb_tries)
        return np.argmax(upper_bounds)
</code></pre><pre class="code-block language-python"><code class=" language-python">def thompson(nb_tries, cum_rewards, param):
    k = np.shape(nb_tries)[0]
    if param == "beta":
        # Beta prior
        try:
            samples = np.random.beta(cum_rewards + 1, nb_tries - cum_rewards + 1)
        except:
            samples = np.random.random(k)
    else:
        # Normal prior
        samples = np.random.normal(cum_rewards / (nb_tries + 1), 1. / (nb_tries + 1))
    return np.argmax(samples)
</code></pre><pre class="code-block language-python"><code class=" language-python">def get_action(algo, nb_tries, cum_rewards, param = None):
    if algo == "eps_greedy":
        return eps_greedy(nb_tries, cum_rewards, param)
    elif algo == "adaptive_greedy":
        return adaptive_greedy(nb_tries, cum_rewards, param)
    elif algo == "ucb":
        return ucb(nb_tries, cum_rewards, param)
    elif algo == "thompson":
        return thompson(nb_tries, cum_rewards, param)
</code></pre><pre class="code-block language-python"><code class=" language-python">def get_bernoulli_reward(a, model_param):
    return float(np.random.random() < model_param[a])
</code></pre><pre class="code-block language-python"><code class=" language-python">def simple_test(algo, model_param = [0.1, 0.6, 0.3], time_horizon = 20, param = None):
    k = len(model_param)
    nb_tries = np.zeros(k, int)
    cum_rewards = np.zeros(k, float)
    print ("action -> reward")
    for t in range(time_horizon):
        a = get_action(algo, nb_tries, cum_rewards, param)
        r = get_bernoulli_reward(a, model_param)
        print(str(a) + " -> " + str(int(r)))
        nb_tries[a] += 1
        cum_rewards[a] += r
    index = np.where(nb_tries > 0)[0]
    best_action = index[np.argmax(cum_rewards[index] / nb_tries[index])]
    print("Best action (estimation) = ", best_action)
</code></pre><pre class="code-block language-python"><code class=" language-python">algos = ["eps_greedy", "adaptive_greedy", "ucb", "thompson"]
</code></pre><pre class="code-block language-python"><code class=" language-python">algo = algos[3]
simple_test(algo)
</code></pre><p>action -&gt; reward<br>
2 -&gt; 0<br>
2 -&gt; 0<br>
0 -&gt; 0<br>
2 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
2 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 0<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 1<br>
1 -&gt; 0<br>
1 -&gt; 0<br>
1 -&gt; 1<br>
Best action (estimation) =  1</p>
<h3 id="regret-and-precision" tabindex="-1">Regret and precision <a class="direct-link" href="#regret-and-precision" aria-hidden="true"></a></h3>
<p>We now compare the performance of the algorithms in terms of <strong>regret</strong> and <strong>precision</strong>.</p>
<p>We consider two models: Bernoulli rewards and normal rewards.</p>
<pre class="code-block language-python"><code class=" language-python">def get_reward(a, model, model_param):
    if model == "bernoulli":
        return float(np.random.random() < model_param[a])
    elif model == "normal":
        return np.random.normal(*model_param[a])
</code></pre><pre class="code-block language-python"><code class=" language-python">def simulate(model, model_param, time_horizon, algo, param = None):
    k = len(model_param)
    nb_tries = np.zeros(k, int)
    cum_rewards = np.zeros(k, float)
    action_seq = []
    reward_seq = []
    for t in range(time_horizon):
        a = get_action(algo, nb_tries, cum_rewards, param)
        r = get_reward(a, model, model_param)
        nb_tries[a] += 1
        cum_rewards[a] += r
        action_seq.append(a)
        reward_seq.append(r)
    return action_seq, reward_seq
</code></pre><pre class="code-block language-python"><code class=" language-python"># Bernoulli rewards
model = "bernoulli"
model_param = [0.1, 0.6, 0.3]
time_horizon = 20
algo = algos[1]
action_seq, reward_seq = simulate(model, model_param, time_horizon, algo)
print(action_seq)
print(reward_seq)
</code></pre><p>[0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]<br>
[0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0]</p>
<pre class="code-block language-python"><code class=" language-python"># Normal rewards
model = "normal"
model_param = [(2,1), (2.5,1)]
action_seq, reward_seq = simulate(model, model_param, time_horizon, algo)
print(action_seq)
print(reward_seq)
</code></pre><p>[0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]<br>
[1.179115746836822, -1.7287995218220553, 2.9824932372612576, 4.70929759324456, 2.680146152730028, 1.4290308142715937, 1.8901714668658633, 2.400874122036182, 2.343488568046762, 2.945493694373399, 1.5180819830660592, 0.6047846869116558, 2.3886517354112042, 1.121706354860382, 2.2243707175008653, 2.0388350243462257, 2.1270553228483826, 1.3483034375420133, 0.8298318872576476, 1.1361810591475932]</p>
<hr>
<p><strong>Note:</strong> The <code>get_best_action</code> function returns the list of best actions and the corresponding expected reward.</p>
<hr>
<pre class="code-block language-python"><code class=" language-python">def get_best_action(model, model_param):
    if model == "bernoulli":
        best_reward = np.max(model_param)
        best_actions = list(np.where(model_param == best_reward)[0])
    elif model == "normal":
        means = [model_param[a][0] for a in range(len(model_param))]
        best_reward = np.max(model_param)
        best_actions = list(np.where(means == best_reward)[0])
    return best_actions, best_reward
</code></pre><pre class="code-block language-python"><code class=" language-python">def get_metrics(action_seq, reward_seq, best_actions, best_reward):
    time_horizon = len(action_seq)
    regret = best_reward * np.arange(time_horizon) - np.cumsum(reward_seq)
    precision = np.cumsum([int(a in best_actions) for a in action_seq]) / (np.arange(time_horizon) + 1)
    return regret, precision
</code></pre><pre class="code-block language-python"><code class=" language-python">def show_metrics(metrics):
    fig, (ax1, ax2) = plt.subplots(1,2,figsize=(12, 4))
    ax1.set_xlabel('Time')
    ax1.set_ylabel('Regret')
    ax1.plot(range(time_horizon),metrics[0], color = 'b')
    ax2.set_xlabel('Time')
    ax2.set_ylabel('Precision')
    ax2.set_ylim(-0.02,1.02)
    ax2.plot(range(time_horizon),metrics[1], color = 'b')
    plt.show()
</code></pre><pre class="code-block language-python"><code class=" language-python">time_horizon = 10000
model = "bernoulli"
model_param = [0.2, 0.5]
</code></pre><pre class="code-block language-python"><code class=" language-python">algo = algos[2]
results = simulate(model, model_param, time_horizon,  algo)
metrics = get_metrics(*results, *get_best_action(model, model_param))
show_metrics(metrics)
</code></pre><p><img src="/img/bandit/output_25_0.png" alt="png"></p>
<h3 id="statistics" tabindex="-1">Statistics <a class="direct-link" href="#statistics" aria-hidden="true"></a></h3>
<p>Finally, we provide some statistics on the performance of each algorithm for different time horizons.</p>
<hr>
<hr>
<pre class="code-block language-python"><code class=" language-python">def get_stats(nb_samples, time_periods, model, model_param, algo, param = None):
    time_horizon = max(time_periods)
    norm_regret_samples = [[] for t in time_periods]
    precision_samples = [[] for t in time_periods]
    for s in range(nb_samples):
        results = simulate(model, model_param, time_horizon, algo, param)
        regret, precision = get_metrics(*results, *get_best_action(model, model_param))
        for i,t in enumerate(time_periods):
            norm_regret_samples[i].append(regret[t - 1] / t)
            precision_samples[i].append(precision[t - 1])
    return norm_regret_samples, precision_samples
</code></pre><pre class="code-block language-python"><code class=" language-python">def show_stats(time_periods, stats):
    meanprops = dict(marker='o', markeredgecolor='black', markerfacecolor='r')
    medianprops = dict(linestyle='-', linewidth=2.5, color = 'b')
    fig, (ax1, ax2) = plt.subplots(1,2,figsize=(12, 4))
    ax1.boxplot(stats[0], positions = range(len(time_periods)), showfliers = False, showmeans = True, meanprops = meanprops, medianprops = medianprops)
    ax1.axhline(linestyle = '--', color = 'r')
    ax1.set_xticklabels(time_periods)
    ax1.set_xlabel('Time horizon')
    ax1.set_ylabel('Normalized regret')
    ax2.boxplot(stats[1], positions = range(len(time_periods)), showfliers = False, showmeans = True, meanprops = meanprops, medianprops = medianprops)
    ax2.set_ylim(-0.02,1.02)
    ax2.axhline(y = 1, linestyle = '--', color = 'r')
    ax2.set_xticklabels(time_periods)
    ax2.set_xlabel('Time horizon')
    ax2.set_ylabel('Precision')
    plt.show()
</code></pre><pre class="code-block language-python"><code class=" language-python">time_periods = [100,1000,5000]
nb_samples = 100
model = "bernoulli"
model_param = [0.1, 0.2]
algo = algos[3]
stats = get_stats(nb_samples, time_periods, model, model_param, algo)
</code></pre><pre class="code-block language-python"><code class=" language-python">show_stats(time_periods, stats)
</code></pre><p><img src="/img/bandit/output_30_0.png" alt="png"></p>

        </div>

        

        <nav class="article-navigation">
          
            
            

            <div class="article-navigation-prev">
              
                <span class="article-navigation-label">Previous Article</span>
                <a href="/_posts/2021-04-25-NP/">How to transfer a Neo4j graph to a Python graph</a>
              
            </div>

            <div class="article-navigation-next text-right">
              
                <span class="article-navigation-label">Next Article</span>
                <a href="/_posts/2020-03-14-GL/">Exploring Modern Graph Theory: Bridging Structure and Complexity</a>
              
            </div>
          
        </nav>
      </article>
    </div>

    <div class="col-lg-4">
      <aside class="sidebar">
        <div class="sidebar-sticky">
          <div class="sidebar-box">
            <h3 class="sidebar-title">About</h3>
            <p>Modern cloud, data, and AI architecture</p>
            <a href="/about/" class="btn btn-outline-primary btn-sm">Learn more</a>
          </div>
          
          <div class="sidebar-box">
            <h3 class="sidebar-title">Stay Connected</h3>
            <div class="social-media">
              <a href="https://github.com/AbdelfattahAbouelaoualim" target="_blank" title="GitHub">
                <i class="fab fa-github"></i>
              </a>
              <a href="https://www.linkedin.com/in/ia-ds-bg/" target="_blank" title="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>
</div> 
    </main>
    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 mb-4">
            <h5>About</h5>
            <p>Modern cloud, data, and AI architecture</p>
            <div class="social-media mt-3">
              <a href="https://github.com/AbdelfattahAbouelaoualim" target="_blank" title="GitHub">
                <i class="fab fa-github"></i>
              </a>
              <a href="https://www.linkedin.com/in/ia-ds-bg/" target="_blank" title="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
              </a>
            </div>
          </div>
          <div class="col-lg-4 mb-4">
            <h5>Quick Links</h5>
            <ul>
                <li>
                  <a href="/">Home</a>
                </li>
                <li>
                  <a href="/about/">About</a>
                </li>
                <li>
                  <a href="/author/">Author</a>
                </li>
                <li>
                  <a href="/contact/">Contact</a>
                </li>
            </ul>
          </div>
          <div class="col-lg-4">
            <h5>Categories</h5>
            <ul>
                
                  <li>
                    <a href="/categories/#computer-science">Computer Science</a>
                  </li>
                
                
                  <li>
                    <a href="/categories/#data-engineering">Data Engineering</a>
                  </li>
                
                
                  <li>
                    <a href="/categories/#mathematics">Mathematics</a>
                  </li>
                
                
                  <li>
                    <a href="/categories/#graph-theory">Graph Theory</a>
                  </li>
                
                
                  <li>
                    <a href="/categories/#machine-learning">Machine Learning</a>
                  </li>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2025
            The Architect | Made with
            <i class="fas fa-heart text-danger"></i>
          </p>
        </div>
      </div>
    </footer>
    <!-- Back to Top Button -->
    <div id="back-to-top" class="d-none">
      <a href="#" class="btn btn-primary btn-sm rounded-circle">
        <i class="fas fa-arrow-up"></i>
      </a>
    </div>
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Back to top button
      $(window).scroll(function () {
        if ($(this).scrollTop() > 300) {
          $('#back-to-top').removeClass('d-none').addClass('d-block');
        } else {
          $('#back-to-top').removeClass('d-block').addClass('d-none');
        }
      });
      $('#back-to-top a').click(function (e) {
        e.preventDefault();
        $('html, body').animate({
          scrollTop: 0
        }, 300);
        return false;
      });
    </script>
  </body>
</html>